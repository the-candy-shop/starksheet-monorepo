services:
  ethereum-devnet:
    platform: linux/x86_64
    image: ghcr.io/foundry-rs/foundry
    entrypoint: anvil
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8545"]
      interval: 5s
    ports:
      - '8545:8545'
    environment:
      ANVIL_IP_ADDR: "0.0.0.0"

  ethereum-deployer:
    depends_on:
      ethereum-devnet:
        condition: service_healthy
    platform: linux/x86_64
    image: ghcr.io/foundry-rs/foundry
    entrypoint: forge
    environment:
      PRIVATE_KEY: "0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"
      ETHERSCAN_API_KEY: "foobar"
    volumes:
      - ./:/app/starksheet/
    working_dir: /app/starksheet/packages/starksheet-solidity
    command:
      - "script"
      - "script/Evmsheet.s.sol"
      - "--broadcast"
      - "-vvvv"
      - "--rpc-url"
      - "http://ethereum-devnet:8545"

  ethereum-webapp:
    depends_on:
      ethereum-deployer:
        condition: service_completed_successfully
    build:
      context: ./packages/starksheet-webapp
    volumes:
      - ./:/app/starksheet/
    environment:
      - REACT_APP_NETWORK=anvil
    ports:
      - '3000:3000'
